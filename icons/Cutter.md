# Руководство по работе с icon cutter

### Что такое "срезанные" иконки?

В SS13 некоторые иконки по сути "сшиваются" из меньшего набора состояний (icon states).

Сглаживание (smoothing) — главный пример, хотя любая система, которая берёт базовое изображение и работает с ним, хорошо вписывается в эту концепцию.

### Как работает cutter?

Cutter имеет несколько различных режимов — разных способов обработки изображений. Все они принимают какие-то входные данные вместе с конфигурационным файлом (.toml), который говорит им, что ДЕЛАТЬ с этими данными.

Файл .toml указывает, какой режим cutter'а использовать, вместе с любыми настройками. Конфиги сглаживания могут использовать шаблоны вместо копирования кучи информации; шаблоны хранятся в папке `cutter_templates`.

Файл toml должен называться так: `{имя}.{расширение_входного_файла}.toml`. Например, если у меня есть конфиг, который использует PNG на вход (как почти все режимы), он будет выглядеть как `{имя}.png.toml`.

Затем он использует файл `{имя}.png`, чтобы создать `{имя}.dmi` (или что там этот режим cutter'а выдаёт на выходе).

Вам НИКОГДА не следует изменять выходные файлы cutter'а — они будут перезаписаны. Изменять нужно только входные данные (конфиги, PNG и т.д.).

Как я уже сказал, наш cutter имеет несколько различных режимов, которые делают разные вещи с разными входными данными.

Большинство cutter'ов в нашем репозитории используют режим `BitmaskSlice`. Информацию о нём можно найти [здесь](https://github.com/actioninja/hypnagogic/blob/master/examples/bitmask-slice.toml).

## Сглаживание по битовой маске (BitmaskSlice)

Мы используем сглаживание по битовой маске, чтобы объекты в мире объединялись друг с другом, "сглаживаясь".

Это делается путём проверки окружения этих объектов на наличие things, с которыми нужно сгладиться, и кодирования этого в виде набора направлений.
Теперь нам нужны состояния иконки для каждой возможной комбинации направлений сглаживания, но сделать их вручную невозможно.

Поэтому вместо этого мы берём базовый набор направлений (обычно: нет соединений, север/юг, восток/запад, север/юг/восток/запад и все соединения), нарезаем их и сшиваем вместе.

Выглядит это примерно так:

> Пример: [Бамбук](turf/floors/bamboo_mat.png.toml)
>
> PNG из блоков 32x32, представляющих соединения.
>
> [Нет, Север + Юг, Восток + Запад, Север + Юг + Восток + Запад, Все]
>
> [<img alt="Бамбуковый шаблон" src="turf/floors/bamboo_mat.png" width="320px">](turf/floors/bamboo_mat.png)
>
> И его выходной DMI:
>
> [<img alt="Результат для бамбука" src="turf/floors/bamboo_mat.dmi" width="320px">](turf/floors/bamboo_mat.dmi)

### Как изменить сглаженную иконку?

Измените PNG-файл, затем пересоберите игру/запустите `build.bat` — выходной DMI сгенерируется автоматически.

### Как создать сглаженную иконку?

1.  Создайте PNG-файл с именем `{имя_dmi}.png`. Его ширина должна быть в 5 раз больше ширины DMI, а высота — равна высоте DMI.
2.  Создайте конфигурационный файл `{имя_dmi}.png.toml`, установите его [шаблон](../cutter_templates/bitmask) на нужный вам стиль. Не забудьте установить переменную `output_name` на базовое состояние иконки, которое вы используете.

Когда закончите, просто запустите `build.bat` или пересоберите проект — и cut-файлы DMI сгенерируются автоматически.

Если вы хотите создать что-то с нестандартными границами, вам нужно будет установить соответствующие переменные. Вы можете прочитать примеры [здесь](https://github.com/actioninja/hypnagogic/tree/master/examples), чтобы понять конфиги разных режимов.

> Пример: [Трава (50x50)](turf/floors/grass.png.toml)
>
> [<img alt="Шаблон травы (50x50)" src="turf/floors/grass.png" width="320px"/>](turf/floors/grass.png)

Если вы хотите задать уникальное состояние иконки для конкретного соединения сглаживания, используйте переменную `prefabs`, добавьте новое "state" в PNG и измените конфиг, чтобы он знал, как его использовать.

> Пример: [Ковры Donk (Большой карман)](turf/floors/carpet_donk.png.toml)
>
> [<img alt="Шаблон ковра Donk" src="turf/floors/carpet_donk.png" width="384x"/>](turf/floors/carpet_donk.png)

Если вы хотите сделать анимированную сглаженную иконку, добавьте ещё один ряд состояний под первым. Каждый новый ряд — это новый кадр. Задержки определяются внутри конфигурационного файла в децисекундах.

> Пример: [Лава (Анимированная, 4 кадра)](turf/floors/lava.png.toml)
>
> [<img alt="Лава (Анимированная)" src="turf/floors/lava.png" width="320px"/>](turf/floors/lava.png)
