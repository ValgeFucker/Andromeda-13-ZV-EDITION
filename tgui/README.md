# tgui

## Введение

tgui — это надежный фреймворк пользовательского интерфейса, используемый на /tg/station.

tgui сильно отличается от большинства UI, с которыми вы сталкивались в программировании на BYOND. Он в значительной степени полагается на JavaScript и веб-технологии, в отличие от DM. Если вы знакомы с NanoUI (библиотека, которую можно найти почти в каждой другой кодовой базе SS13), изучить tgui должно быть довольно легко.

## Изучение tgui

Люди приходят к tgui с разным бэкграундом и разными стилями обучения. Независимо от того, предпочитаете ли вы более теоретический или практический подход, мы надеемся, что этот раздел будет вам полезен.

### Практическое руководство

Если вы совершенно новичок во фронтенде и предпочитаете **учиться на практике**, начните с нашего [практического руководства](docs/tutorial-and-examples.md).

### Гайды

Этот проект использует React. Не торопитесь, чтобы прочитать руководство:

- [Руководство по React](https://react.dev/learn)

Если вы уже были знакомы со старой версией tgui на основе Ractive и хотите перенести концепции между старой и новой tgui, прочтите это [руководство по конвертации интерфейсов](docs/converting-old-tgui-interfaces.md).

### Другая документация

- [Справочник компонентов](https://tgstation.github.io/tgui-core/?path=/docs/components-animatednumber--docs) — Базовые строительные блоки UI
- [Tgui Core](https://github.com/tgstation/tgui-core) — Библиотека компонентов для tgui.
- [Использование TGUI и Byond API для пользовательских HTML-всплывающих окон](docs/tgui-for-custom-html-popups.md)
- [Компоненты, встроенные в чат](docs/chat-embedded-components.md)
- [Написание тестов](docs/writing-tests.md)

## Предварительные требования

Если вы используете инструменты, предоставленные в этом репозитории, всё включено! Можете смело пропустить этот шаг.

Однако, если вам нужен более детальный контроль над процессом установки или сборки, вам понадобится следующее:

- [Node v22.11+](https://nodejs.org/en/download/)
  - Рекомендуется использовать **LTS**-релиз вместо последней версии.
  - **НЕ УСТАНАВЛИВАЙТЕ Chocolatey, если установщик Node предложит это сделать!**
- [Yarn v4.8.1+](https://yarnpkg.com/getting-started/install)
  - Yarn обычно устанавливается с помощью corepack.

## Использование

**С помощью предоставленных cmd-скриптов (Windows)**:

- `bin/tgui-build` — Собрать tgui в режиме production и запустить полный набор проверок кода.
- `bin/tgui-dev` — Запустить сервер для разработки (dev-сервер).
  - `bin/tgui-dev --reload` — Перезагрузить кеш BYOND один раз.
  - `bin/tgui-dev --debug` — Запустить сервер с включенным отладочным логированием.

> Чтобы открыть окно CMD или PowerShell в любой открытой папке, щелкните правой кнопкой мыши **удерживая Shift** на любом свободном месте в папке, затем нажмите либо `Open command window here`, либо `Open PowerShell window here`.

**Через Juke Build (кроссплатформенно(Нет))**:

- `tools/build/build.sh tgui` — Собрать tgui в режиме production.
- `tools/build/build.sh tgui-dev` — Собрать tgui в режиме для разработки (development).
  - `tools/build/build.sh tgui-dev --reload` — Перезагрузить кеш BYOND один раз.
  - `tools/build/build.sh tgui-dev --debug` — Запустить сервер с включенным отладочным логированием.
- `tools/build/build.sh tgui-lint` — Показать (и автоматически исправить) проблемы в коде.
- `tools/build/build.sh tgui-test` — Запустить модульные и интеграционные тесты.
- `tools/build/build.sh tgui-analyze` — Запустить анализатор бандла (bundle analyzer).
- `tools/build/build.sh tgui-clean` — Очистить папку tgui.

> С Juke Build вы можете запускать несколько целей вместе, например:
>
> ```
> tools/build/build.sh tgui tgui-lint tgui-tsc tgui-test
> ```

**Через Bun (кроссплатформенно)**:

Выполните `bun install` один раз, чтобы установить зависимости tgui.

- `bun tgui:build` — Собрать tgui в режиме production.
  - `bun tgui:build [options]` — Собрать tgui с пользовательскими опциями webpack.
- `bun tgui:dev` — Запустить сервер для разработки (dev-сервер).
  - `bun tgui:dev --reload` — Перезагрузить кеш BYOND один раз.
  - `bun tgui:dev --debug` — Запустить сервер с включенным отладочным логированием.
- `bun tgui:lint` — Показать (и автоматически исправить) проблемы в коде.
- `bun tgui:tsc` — Проверить код с помощью компилятора TypeScript.
- `bun tgui:test` — Запустить модульные и интеграционные тесты.
- `bun tgui:analyze` — Запустить анализатор бандла (bundle analyzer).
- `bun tgfont:build` — Собрать шрифты иконок.

## Важное примечание

Помните, что всегда нужно выполнять полную сборку tgui перед отправкой PR (Pull Request), потому что она сопровождается полным набором проверок CI и работает на вашем компьютере намного быстрее, чем на серверах GitHub. Это сэкономит вам время и, возможно, несколько неудачных коммитов! Исправляйте проблемы, о которых сообщают инструменты, насколько это возможно, потому что сопровождающие (maintainers) будут бить вас линейкой и всё равно заставят вас их исправить (если это не ложное срабатывание или что-то неустранимое).

## Решение проблем

**Сервер разработки не подключается к игре**

Убедитесь, что у вас открыто окно tgui, прежде чем запускать dev-сервер. Затем, когда он запустится, вам, возможно, потребуется нажать F5 для обновления страницы.

**Сервер разработки вылетает (crashing)**

Убедитесь, что путь к вашей рабочей директории не содержит пробелов, специальных символов Юникода, восклицательных знаков или любых других специальных символов. Если это не так, переместите кодобазу в место, которое не содержит этих символов.

**Сервер разработки не находит мой кеш BYOND!**

Это происходит, если ваша папка «Документы» в Windows имеет нестандартное расположение, например, в `E:\Libraries\Documents`. Сервер разработки делает всё возможное, чтобы найти это нестандартное расположение (ищет ключ в реестре Windows), но может и не найти. Вам нужно запустить dev-сервер с дополнительной переменной окружения, указывающей полный путь к кешу BYOND.

```
BYOND_CACHE="E:/Libraries/Documents/BYOND/cache"
```


**Webpack выдаёт ошибку с какими-то загадочными сообщениями!**

> Пример: `No template for dependency: PureExpressionDependency`

Начиная с tgui 4.3, Webpack хранит свой кеш на диске, и он очень чувствителен к конфигурации сборки. Поэтому, если вы обновите webpack или будете использовать один и тот же кеш для сборки в режимах development и production, он начнёт «глючить» (hallucinating).

Чтобы устранить проблему такого рода, выполните `bin/tgui --clean` и попробуйте снова.

## Инструменты Dev-сервера

При разработке с помощью `tgui-dev-server` у вас будет доступ к некоторым функциям, доступным только для разработки.

**Отладочные логи (Debug Logs).** При запуске сервера через `bin/tgui --dev --debug` сервер будет выводить отладочные логи и время, затраченное на рендеринг. Используйте эту информацию для оптимизации вашего кода и старайтесь сохранять время повторного рендера ниже 16 мс.

**Кухонная раковина (Kitchen Sink).** Нажмите `F12` или нажмите на зеленого жучка, чтобы открыть интерфейс KitchenSink. Этот интерфейс представляет собой полигон для тестирования различных компонентов tgui.

**Отладчик макета (Layout Debugger).** Нажмите `F11`, чтобы переключить *отладчик макета*. Он покажет контуры всех элементов tgui, что позволяет легко понять, как всё соединяется вместе, и может выявить определённые ошибки вёрстки, которые обычно не видны.

## Инструменты разработчика браузера

WebView2 основан на Chromium, поэтому получить доступ к инструментам разработчика стало намного проще, чем у его предшественника. Просто перейдите на вкладку отладки (debug) в панели состояния (stat panel) и нажмите «Allow Browser Inspection». Затем вы можете нажать F12, чтобы открыть стандартные инструменты разработчика Chrome.

## Структура проекта

- `/packages` — Каждая папка здесь представляет собой автономный Node-модуль.
- `/packages/common` — Вспомогательные функции, которые используются во всех пакетах.
- `/packages/tgui/index.ts` — Точка входа в приложение.
- `/packages/tgui/interfaces` — Фактические внутриигровые интерфейсы.
- `/packages/tgui/layouts` — Компоненты UI корневого уровня, которые влияют на окончательный внешний вид и поведение окна браузера. Они содержат различные элементы окна, такие как строка заголовка и обработчики изменения размера, и управляют темой UI.
- `/packages/tgui/routes.ts` — Здесь tgui решает, какой интерфейс нужно загрузить и отрендерить.
- `/packages/tgui/styles/main.scss` — Точка входа для CSS.
- `/packages/tgui/styles/functions.scss` — Полезные SASS-функции. Здесь определены такие функции, как `lighten`, `darken`, `luminance`.
- `/packages/tgui/styles/atomic` — Атомарные CSS-классы. Это очень простые, маленькие, многократно используемые CSS-классы, которые вы можете использовать и комбинировать для изменения внешнего вида ваших элементов. Держите их небольшими.
- `/packages/tgui/styles/interfaces` — Пользовательские таблицы стилей для ваших интерфейсов. Добавляйте таблицы стилей сюда, если вам действительно нужен детальный контроль над стилями вашего UI.
- `/packages/tgui/styles/layouts` — Стили, связанные с макетом.
- `/packages/tgui/styles/themes` — Содержит темы, которые вы можете использовать в tgui. Каждая тема должна быть зарегистрирована в файле `/packages/tgui/index.ts`.

## Лицензия

Исходный код распространяется под родительской лицензией /tg/station — **AGPL-3.0** (см. основной [README](../README.md)), если не указано иное.

Некоторые файлы снабжены заголовком об авторском праве, в котором явно указаны правообладатель и лицензия файла. Большая часть основного исходного кода tgui доступна по лицензии **MIT**.

Авторы сохраняют за собой все авторские права на представленные здесь работы.
